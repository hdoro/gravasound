<script>
	export let state
	export let send

	let audioEl
	let playing = false

	$: if (playing) {
		audioEl?.play?.()
	} else {
		audioEl?.pause?.()
	}
</script>

<div class="container" data-color="emerald">
	<div class="header text-md">
		<h1>Check your recording</h1>
		<p class="text-md">All good? Go ahead and send it :D</p>
	</div>

	{#if $state.context.recordingBlob}
		<audio
			src={URL.createObjectURL($state.context.recordingBlob)}
			bind:this={audioEl}
			on:ended={() => (playing = false)}
		/>
	{/if}
	<button
		on:click|preventDefault={() => (playing = !playing)}
		type="button"
		class="btn play-btn"
	>
		<span class="sr-only">{playing ? 'Stop' : 'Play'} recording</span>
		{#if playing}
			<svg
				viewBox="0 0 114 114"
				fill="currentColor"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M16.9336 0.527832C12.5824 0.527832 8.40939 2.25634 5.33262 5.33311C2.25586 8.40988 0.527344 12.5829 0.527344 16.9341V96.6216C0.527344 105.678 7.87734 113.028 16.9336 113.028H30.9961C35.3473 113.028 39.5203 111.299 42.5971 108.223C45.6738 105.146 47.4023 100.973 47.4023 96.6216V16.9341C47.4023 12.5829 45.6738 8.40988 42.5971 5.33311C39.5203 2.25634 35.3473 0.527832 30.9961 0.527832H16.9336ZM82.5586 0.527832C78.2074 0.527832 74.0344 2.25634 70.9576 5.33311C67.8809 8.40988 66.1523 12.5829 66.1523 16.9341V96.6216C66.1523 105.678 73.5023 113.028 82.5586 113.028H96.6211C100.972 113.028 105.145 111.299 108.222 108.223C111.299 105.146 113.027 100.973 113.027 96.6216V16.9341C113.027 12.5829 111.299 8.40988 108.222 5.33311C105.145 2.25634 100.972 0.527832 96.6211 0.527832H82.5586Z"
				/>
			</svg>
		{:else}
			<svg
				viewBox="0 0 104 114"
				fill="currentColor"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M21.2305 2.32783C19.091 1.12522 16.674 0.503492 14.2198 0.524438C11.7656 0.545384 9.35962 1.20828 7.24099 2.44723C5.12236 3.68617 3.36487 5.45803 2.14322 7.58669C0.921572 9.71534 0.278299 12.1267 0.277344 14.581V98.956C0.276663 101.411 0.918745 103.824 2.13973 105.954C3.36071 108.083 5.11804 109.857 7.23694 111.097C9.35585 112.337 11.7625 113 14.2175 113.022C16.6725 113.043 19.0903 112.421 21.2305 111.218L96.2305 69.031C98.4058 67.8078 100.217 66.0278 101.477 63.8737C102.737 61.7195 103.401 59.2688 103.401 56.7731C103.401 54.2775 102.737 51.8268 101.477 49.6726C100.217 47.5185 98.4058 45.7384 96.2305 44.5153L21.2305 2.32783V2.32783Z"
				/>
			</svg>
		{/if}
	</button>

	<div class="actions-footer">
		<button
			on:click|preventDefault={() => send('RETAKE_RECORDING')}
			type="button"
			data-color="red"
			class="btn"
		>
			<svg
				viewBox="0 0 24 25"
				fill="currentColor"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M21 13C21.0002 11.3007 20.5193 9.63611 19.6129 8.19872C18.7066 6.76134 17.4118 5.60991 15.8784 4.87763C14.345 4.14535 12.6357 3.86214 10.948 4.06076C9.2604 4.25938 7.66348 4.93171 6.342 5.99999H8.5C8.89782 5.99999 9.27936 6.15803 9.56066 6.43933C9.84196 6.72063 10 7.10217 10 7.49999C10 7.89782 9.84196 8.27935 9.56066 8.56065C9.27936 8.84196 8.89782 8.99999 8.5 8.99999H3.5C3.10218 8.99999 2.72064 8.84196 2.43934 8.56065C2.15804 8.27935 2 7.89782 2 7.49999V2.49999C2 2.10217 2.15804 1.72063 2.43934 1.43933C2.72064 1.15803 3.10218 0.999991 3.5 0.999991C3.89782 0.999991 4.27936 1.15803 4.56066 1.43933C4.84196 1.72063 5 2.10217 5 2.49999V3.25199C7.18698 1.68134 9.83864 0.891829 12.5286 1.01043C15.2185 1.12904 17.7904 2.14886 19.8307 3.90589C21.8709 5.66293 23.261 8.05509 23.7773 10.6977C24.2936 13.3403 23.9062 16.0797 22.6774 18.4755C21.4485 20.8713 19.4496 22.7841 17.0021 23.9065C14.5547 25.0289 11.8009 25.2955 9.18352 24.6636C6.56618 24.0316 4.23743 22.5378 2.57175 20.4223C0.906075 18.3068 0.000270514 15.6925 0 13C8.38353e-09 12.6022 0.158035 12.2206 0.43934 11.9393C0.720644 11.658 1.10218 11.5 1.5 11.5C1.89782 11.5 2.27936 11.658 2.56066 11.9393C2.84196 12.2206 3 12.6022 3 13C3 15.3869 3.94821 17.6761 5.63604 19.364C7.32387 21.0518 9.61305 22 12 22C14.3869 22 16.6761 21.0518 18.364 19.364C20.0518 17.6761 21 15.3869 21 13V13Z"
				/>
			</svg>
			Retake
		</button>
		<button
			on:click|preventDefault={() => send('UPLOAD_RECORDING')}
			type="button"
			class="btn"
		>
			<svg
				viewBox="0 0 28 28"
				fill="currentColor"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M1.4483 0.106116C1.2809 0.0223903 1.09336 -0.0126735 0.907019 0.00491264C0.720676 0.0224988 0.54301 0.092029 0.39423 0.205594C0.245449 0.319159 0.131527 0.4722 0.0654217 0.647308C-0.000683174 0.822416 -0.0163171 1.01256 0.0202984 1.19612L2.8263 10.8961C2.87862 11.0769 2.98089 11.2392 3.12134 11.3645C3.2618 11.4897 3.43474 11.5728 3.6203 11.6041L15.0003 13.5101C15.5363 13.6161 15.5363 14.3841 15.0003 14.4901L3.6203 16.3961C3.43474 16.4275 3.2618 16.5105 3.12134 16.6358C2.98089 16.761 2.87862 16.9234 2.8263 17.1041L0.0202984 26.8041C-0.0163171 26.9877 -0.000683174 27.1778 0.0654217 27.3529C0.131527 27.528 0.245449 27.6811 0.39423 27.7946C0.54301 27.9082 0.720676 27.9777 0.907019 27.9953C1.09336 28.0129 1.2809 27.9778 1.4483 27.8941L27.4483 14.8941C27.6142 14.811 27.7537 14.6833 27.8511 14.5254C27.9486 14.3676 28.0002 14.1857 28.0002 14.0001C28.0002 13.8146 27.9486 13.6327 27.8511 13.4748C27.7537 13.3169 27.6142 13.1893 27.4483 13.1061L1.4483 0.106116V0.106116Z"
				/>
			</svg>
			Send
		</button>
	</div>
</div>

<style>
	.container {
		gap: 0.5rem;
		text-align: center;
		display: flex;
		align-items: center;
		flex-direction: column;
	}
	.header {
		color: var(--color-tailwind-slate-600);
	}

	.btn {
		margin-top: 2em;
	}

	.play-btn {
		font-size: 2rem;
		position: relative;
	}
</style>
